# CloudRunへのデプロイ手順

このドキュメントでは、「リポジトリを接続」機能を使用してCloudRunにアプリケーションをデプロイする手順を説明します。

## 前提条件

- GitHubなどのGitリポジトリにコードがプッシュされていること
- Google Cloud Platformのアカウントとプロジェクトが設定されていること
- 必要な権限が付与されていること

## デプロイ手順

### 1. Google Cloud Consoleにログイン

- [Google Cloud Console](https://console.cloud.google.com/)にアクセスし、ログインします。
- プロジェクト「kawara-board」を選択します。

### 2. CloudRunサービスの作成

1. 左側のナビゲーションメニューから「Cloud Run」を選択します。
2. 「サービスの作成」ボタンをクリックします。
3. 「継続的デプロイを設定する」を選択します。

### 3. リポジトリの接続

1. 「ソースリポジトリ」セクションで、「リポジトリプロバイダを選択」をクリックします。
2. GitHubなどの使用しているリポジトリプロバイダを選択します。
3. 必要に応じて認証を行い、このプロジェクトのリポジトリを選択します。
4. ブランチを選択します（通常は「main」または「master」）。

### 4. ビルド設定

1. 「ビルド設定」セクションで、「Dockerfileを使用」を選択します。
2. Dockerfileの場所を指定します（通常はルートディレクトリの「Dockerfile」）。
3. 必要に応じて「cloudbuild.yaml」を使用するオプションを選択し、ファイルの場所を指定します。

### 5. サービス設定

1. 「サービス名」に「oracledraw」を入力します。
2. 「リージョン」で「asia-northeast1」（東京）を選択します。
3. 「認証」セクションで、必要に応じて「未認証の呼び出しを許可」を選択します。
4. 「サービスアカウント」で「cr-db-master@kawara-board.iam.gserviceaccount.com」を選択します。

### 6. デプロイの実行

1. 「作成」ボタンをクリックして、サービスの作成とデプロイを開始します。
2. デプロイが完了すると、CloudRunサービスのURLが表示されます。

## 自動デプロイ

リポジトリを接続した後は、指定したブランチに変更をプッシュするたびに、自動的にビルドとデプロイが実行されます。デプロイの進行状況は、CloudRunのサービス詳細ページまたはCloud Buildの履歴で確認できます。

## トラブルシューティング

デプロイに失敗した場合は、以下を確認してください：

1. Cloud Buildのログを確認して、ビルドエラーの詳細を確認します。
2. Dockerfileが正しく設定されていることを確認します。
3. サービスアカウントに必要な権限が付与されていることを確認します。
4. プロジェクトのAPIが有効になっていることを確認します（Cloud Run API、Cloud Build API、Container Registry APIなど）。
